---
title: "Fastlaneã‚’ä½¿ã£ãŸiOSã®è¨¼æ˜æ›¸ï¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†"
emoji: "ğŸš€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["iOS", "fastlane", "è¨¼æ˜æ›¸"]
published: true
---

![](https://raw.githubusercontent.com/nomunomu0504/Zenn.dev-Content-public/master/articles/assets/746c9e07095078275e45/1.png)

# å‰ç½®ã

iOS ã‚¢ãƒ—ãƒªã®è¤‡æ•°äººé–‹ç™ºã§ä¸€ç•ªå„ä»‹ãªã®ãŒã€Œè¨¼æ˜æ›¸ã€å‘¨ã‚Šã§ã™ã‚ˆã­ã€‚
æ–°ã—ã„é–‹ç™ºãƒ¡ãƒ³ãƒãƒ¼ãŒ Join ã—ã¦ãã‚‹ã¨ã€æœ€å°é™ã§ã‚‚ä»¥ä¸‹ã®ä½œæ¥­ãŒç™ºç”Ÿã—ã¦ãã¾ã™ã€‚

- AppleDeveloper ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æ–°è¦ä½œæˆ
- æ–°ãƒ¡ãƒ³ãƒãƒ¼ã‚’ DeveloperPortal ã¸æ‹›å¾…
- è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆãƒ»æ›´æ–°

åŸºæœ¬çš„ã«ã¯ã€AutomaticSigning ã«ã‚ˆã£ã¦è‡ªå‹•çš„ã«è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«å‘¨ã‚ŠãŒè¨­å®šã•ã‚Œã¾ã™ãŒã€å³å¯†ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã ã¨è¨¼æ˜æ›¸ã‚’æ–°è¦ä½œæˆã—ã¦ã¯ãªã‚‰ãªã„ã€‚ãªã©ã®åˆ¶ç´„ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

ã¾ãŸã€CI/CD ã‚’é‹ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ã©ã†ã‚„ã£ã¦ CI ä¸Šã§è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰±ã†ã‹ã¨ã„ã£ãŸå•é¡Œã‚‚ç™ºç”Ÿã—ã¦ãã¾ã™ã€‚

ãã“ã§ã€ä»Šå›ã¯ `fastlane` ã® `match` ã‚’ä½¿ã£ã¦è¨¼æ˜æ›¸ã‚’ç®¡ç†ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã€ç°¡å˜ã«è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å…±æœ‰ãƒ»æ›´æ–°ã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

# Fastlane

Fastlane ã¨ã¯ iOS/Android ã§å¿…è¦ãªæ§˜ã€…ãªä½œæ¥­ã‚’è‡ªå‹•åŒ–ã—ã¦ãã‚Œã‚‹ä¾¿åˆ©ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

https://fastlane.tools/

- ipa/apk ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
- AppStoreConnect/GooglePlay ã¸ã‚¢ãƒ—ãƒªã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- AppStoreConnect/GooglePlay ã¸ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ»æ›´æ–°
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- iOS ã®è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- AppDistribution/TestFlight ãªã©ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

# Fastlane match

Fastlane ã® match ã¨ã¯ã€é–‹ç™ºãƒãƒ¼ãƒ ã§å…±æœ‰ã®è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã‚„æ›´æ–°ã‚’è¡Œã„ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«æ ¼ç´ã—ã¦ã€å…¨ãƒ¡ãƒ³ãƒãƒ¼ã§å…±æœ‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ãƒ¡ãƒ³ãƒãƒ¼ãŒè¿½åŠ ã•ã‚ŒãŸã‚‰ã€fastlane match ã‚’ä½¿ã£ã¦ã€ç®¡ç†ã•ã‚Œã¦ã„ã‚‹è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ã§ç™»éŒ²ãƒ»æ›´æ–°ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ã€AppleDeveloper ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ãŸã‚Šãªã©ã®ã€é¢å€’ãªä½œæ¥­ã‚’ã™ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚

ã–ã£ã¨ã—ãŸãƒ•ãƒ­ãƒ¼ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚

![](https://raw.githubusercontent.com/nomunomu0504/Zenn.dev-Content-public/master/articles/assets/746c9e07095078275e45/2.png)

:::message
ãƒ•ãƒ­ãƒ¼å›³ã§ã¯ã€make ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ãŒã€ã“ã®è¨˜äº‹ã§ã¯ fastlane ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œç”¨ã® make ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ã‚‹ã®ã§ã€è¨˜äº‹ã«åˆã‚ã›ãŸã‚³ãƒãƒ³ãƒ‰ã¨ãªã£ã¦ã„ã¾ã™ã€‚
:::

# å°å…¥æ‰‹é †

fastlane å°å…¥ã«ã¯ã€homebrew ã‚„ rubyGem ã‚’ä½¿ã†æ–¹æ³•ãªã©ã€ã„ãã¤ã‹ã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯ rubyGem ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã¨ã—ã¾ã™ã€‚

ã¾ãŸã€å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã«ã¯ `asdf` ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã®ã§ã€å„ç’°å¢ƒã«åˆã‚ã›ã¦èª­ã¿æ›¿ãˆãã ã•ã„ ğŸ™‡â€â™€

:::message
å€‹äººçš„ã«ã¯ asdf ã®ã¿ã§æ§˜ã€…ãªãƒ„ãƒ¼ãƒ«ã® Version ç®¡ç†ãŒã§ãã‚‹ã®ã§ã€ã“ã®éš›ã«å…¥ã‚Œã¦ã¿ã‚‹ã®ã‚‚è‰¯ã„ã‹ã¨æ€ã„ã¾ã™ã€‚
:::

https://asdf-vm.com/

## è¨¼æ˜æ›¸ç®¡ç†ç”¨ã®ãƒªãƒã‚¸ãƒˆãƒªä½œæˆ

fastlane ã§ã¯è¨¼æ˜æ›¸ã‚’ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ãŸã‚ã€Private ã®å°‚ç”¨ãƒªãƒã‚¸ãƒˆãƒªã‚’å…ˆã«æº–å‚™ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## Ruby, Bundler ã®è¨­å®šãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ruby ã¯ `2.7.2` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

ã‚·ã‚¹ãƒ†ãƒ ã§åˆ©ç”¨ã™ã‚‹ ruby ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ã¯ãªã„ã®ã§ã€localï¼ˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã®ã¿é©ç”¨ï¼‰ã§ 2.7.2 ã‚’å‹•ã‹ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

```
$ asdf install ruby 2.7.2
$ asdf local ruby 2.7.2
```

ruby ã®è¨­å®šãŒçµ‚ã‚ã£ãŸã‚‰ã€bundler ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ gem install bundler
```

## fastlane ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

fastlane ã‚’ rubyGem çµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã€Gemfile ã‚’ä½œæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒšã—ã¦ã‚‚ã‚‰ãˆã°å¤§ä¸ˆå¤«ã§ã™ã€‚

Gemfile ã¯ã€`<project_name>.xcodeproj` ãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä½œæˆã—ã¦ãã ã•ã„ã€‚

```
source "https://rubygems.org"

gem "fastlane"

plugins_path = File.join(File.dirname(__FILE__), 'fastlane', 'Pluginfile')
eval_gemfile(plugins_path) if File.exist?(plugins_path)
```

Gemfile ã‚’ä½œæˆã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€fastlane ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ asdf exec bundle update
```

## fastlane ã®åˆæœŸè¨­å®š

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ fastlane ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã®åˆæœŸè¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã©ã®ã‚ˆã†ã« fastlane ã‚’åˆæœŸè¨­å®šã™ã‚‹ã‹ã®é¸æŠè‚¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ã€ã€Œ4ã€ã®æ‰‹å‹•è¨­å®šã‚’é¸æŠã—ã¦ãŠãã¾ã™ã€‚

```
$ asdf exec bundle exec fastlane init
[âœ”] ğŸš€
[âœ”] Looking for iOS and Android projects in current directory...
[02:25:58]: Created new folder './fastlane'.
[02:25:58]: Detected an iOS/macOS project in the current directory: '<project_name>.xcodeproj'
[02:25:58]: -----------------------------
[02:25:58]: --- Welcome to fastlane ğŸš€ ---
[02:25:58]: -----------------------------
[02:25:58]: fastlane can help you with all kinds of automation for your mobile app
[02:25:58]: We recommend automating one task first, and then gradually automating more over time
[02:25:58]: What would you like to use fastlane for?
1. ğŸ“¸  Automate screenshots
2. ğŸ‘©â€âœˆï¸  Automate beta distribution to TestFlight
3. ğŸš€  Automate App Store distribution
4. ğŸ›   Manual setup - manually setup your project to automate your tasks
? 4
```

## fastlane match ã®åˆæœŸè¨­å®š

è¨¼æ˜æ›¸ç®¡ç†ã¯ fastlane ã® match ã‚’ä½¿ã£ã¦è¡Œã†ãŸã‚ã€fastlane ã®è¨­å®šãŒçµ‚ã‚ã£ãŸã‚‰ã€match ã®åˆæœŸè¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

ã©ã®ç’°å¢ƒã§è¨¼æ˜æ›¸ã‚’ç®¡ç†ã™ã‚‹ã‹èã‹ã‚Œã‚‹ãŸã‚ã€ã€Œ1ã€ã® Git ã‚’é¸æŠã—ã¾ã™ã€‚

```
$ asdf exec bundle exec fastlane match init
[âœ”] ğŸš€
[02:31:47]: fastlane match supports multiple storage modes, please select the one you want to use:
1. git
2. google_cloud
3. s3
4. gitlab_secure_files
?  1
```

é¸æŠã™ã‚‹ã¨ã€ãƒªãƒã‚¸ãƒˆãƒªã® URL ã‚’èã‹ã‚Œã‚‹ã®ã§ã€https or ssh ã®ã‚³ãƒ”ãƒšã—ã¾ã™ã€‚

```
[02:32:05]: Please create a new, private git repository to store the certificates and profiles there
[02:32:05]: URL of the Git Repo: <https or sshã®ãƒªãƒã‚¸ãƒˆãƒªURL>

[02:36:51]: Successfully created './fastlane/Matchfile'. You can open the file using a code editor.
[02:36:51]: You can now run `fastlane match development`, `fastlane match adhoc`, `fastlane match enterprise` and `fastlane match appstore`
[02:36:51]: On the first run for each environment it will create the provisioning profiles and
[02:36:51]: certificates for you. From then on, it will automatically import the existing profiles.
[02:36:51]: For more information visit https://docs.fastlane.tools/actions/match/
```

## AppStoreConnect API ã®è¨­å®š

fastlane ã®ã¿ã§è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆãƒ»å‰Šé™¤ãƒ»æ›´æ–°ãŒã§ãã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

AppStoreConnect ã® API ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€TestFlight é…ä¿¡ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿½åŠ ãªã©ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

App Store Connect ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã€Œãƒ¦ãƒ¼ã‚¶ã¨ã‚¢ã‚¯ã‚»ã‚¹ã€ã‹ã‚‰ã€Œã‚­ãƒ¼ã€ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

:::message alert
æ¨©é™ãŒãªã„å ´åˆã€Œã‚­ãƒ¼ã€ã‚¿ãƒ–ã¯è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“
:::

æ–°ã—ã„ API ã‚­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹å ´åˆã«ã¯ã€ç¢ºèªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€å†…å®¹ã‚’ç¢ºèªã—ã¦ã€Œæå‡ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ä¸Šè¨˜ç”»é¢ã«é·ç§»ã—ã¾ã™ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/110131/7072731b-dad4-5be4-a6fc-675fcca90bdc.png)

ã€ŒAPI ã‚­ãƒ¼ã‚’ç”Ÿæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ä»¥ä¸‹ã® API ã‚­ãƒ¼ç™»éŒ²ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/110131/a8b2f427-9d2e-8bd3-bee8-a74d1918f139.png)

ã€Œåå‰ã€ã«ã¯ã©ã“ã§åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ API ã‚­ãƒ¼ãªã®ã‹ãªã©ã€è­˜åˆ¥ã—ã‚„ã™ã„åå‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

ã€Œã‚¢ã‚¯ã‚»ã‚¹ã€ã§ã¯ã€API ã‚­ãƒ¼ã«ä»˜ä¸ã™ã‚‹æ¨©é™ã‚’è¨­å®šã—ã¾ã™ã€‚fastlane ã§ã¯ã€ŒApp Managerã€ã®æ¨©é™ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/110131/8acfdd50-50de-9ae6-522e-ac64c7e99cda.png)

API ã‚­ãƒ¼ãŒç”Ÿæˆã•ã‚Œã‚‹ã¨ã€API ã¸æ¥ç¶šã™ã‚‹ãŸã‚ã«å¿…è¦ãªæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚API ã‚­ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚­ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

:::message alert
ã€ŒAPI ã‚­ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã¯ 1 åº¦ã—ã‹ã§ããªã„ãŸã‚æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚
:::

ã¾ãŸã€

- Issuer ID
- ã‚­ãƒ¼ ID

ã¯ã€fastlane ã®å‡¦ç†ã‚’è¨˜è¿°ã™ã‚‹éš›ã«å¿…è¦ã«ãªã‚‹ãŸã‚ã€ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

## env ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã®å‰æº–å‚™

fastlane ã§ã¯ã€API ã«æ¥ç¶šã™ã‚‹ãŸã‚ã«å¿…è¦ãªæƒ…å ±ã‚’å¤‰æ•°ã«æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

å„æ¥ç¶šæƒ…å ±ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ã¦ã—ã¾ã†ã¨ã€Github ã«æ²è¼‰ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€ä¸‡ãŒä¸€ã®ã¨ãã«ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã«ãªã£ã¦ã—ã¾ã†å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

ãã®ãŸã‚ã€æ¥ç¶šæƒ…å ±ãªã©ã¯å…¨ã¦ env ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

å…ˆç¨‹ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã€ã‚­ãƒ¼æƒ…å ±ã‚‚ env ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ãã®ã¾ã¾ã®å†…å®¹ã‚’è¨˜è¿°ã™ã‚‹ã‚ã‘ã§ã¯ãªãã€base64 åŒ–ã—ãŸã‚‚ã®ã‚’ env ãƒ•ã‚¡ã‚¤ãƒ«ã¸è¨˜è¿°ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€API ã‚­ãƒ¼æƒ…å ±ã‚’ base64 åŒ–ã—ã¾ã™ã€‚å‡ºåŠ›ã•ã‚ŒãŸçµæœã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

```
$ cat AuthKey_KEYID.p8 | base64
```

## env ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

ä½œæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ 2 ã¤ã§ã™ã€‚

- .env
- .env.skel

`.env` ã¯å®Ÿéš›ã«å€¤ãŒå…¥ã£ã¦ã„ã‚‹ã‚‚ã®ã€`.env.skel` ã¯ã©ã®ã‚ˆã†ãªã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã‹ã® Skeleton ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãªã‚Šã¾ã™ã€‚

ã²ã¨ã¾ãš `.env.skel` ã‚’ä½œæˆã—ã¾ã™ã€‚

```
### ä»¥ä¸‹ã‚’ .env.skel ã«ã‚³ãƒ”ãƒ¼
ASC_KEY_ID=
ASC_ISSUER_ID=
ASC_KEY_CONTENT=
MATCH_PASSWORD=
FASTLANE_USER=
```

ãã—ã¦ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ä½œæˆã—ã¦ã€AppStoreConnect API ã®æƒ…å ±ï¼ˆASC_KEY_ID, ASC_ISSUER_ID, ASC_KEY_CONTENTï¼‰ã‚’å«ã‚€è¨­å®šå€¤ã‚’è¨­å®šã—ã¾ã™ã€‚

`MATCH_PASSWORD` ã¯è¨¼æ˜æ›¸ã«è¨­å®šã™ã‚‹ Password ã«ãªã‚Šã¾ã™ã®ã§ã€å„è‡ªä»»æ„ã§è¨­å®šã—ã¦ã‚‚ã‚‰ã£ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚

`FASTLANE_USER` ã¯ AppleId ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸ `.env` ã¯ Github ã§ç®¡ç†ã—ã¾ã›ã‚“ãŒã€`.env.skel` ã¯ç®¡ç†ã—ãŸã„ãŸã‚ã€ä»¥ä¸‹ã®å†…å®¹ã‚’ `.gitignore` ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜ã—ã¾ã™ã€‚

```
.env*
!.env.skel
```

## Fastfile ã®ä¿®æ­£

fastlane ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹ã€Fastfile ã« fastlane ã§å®Ÿè¡Œã—ãŸã„ lane ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ä»Šå›ã® Fastfile ã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ãŒå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

| ã§ãã‚‹ã“ã¨                                                | å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰                     |
| :-------------------------------------------------------- | :------------------------------- |
| Development è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆãƒ»æ›´æ–°  | make match_force_development     |
| Development è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—        | make fetch_development_profiles  |
| Development è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤        | make delete_development_profiles |
| Distribution è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆãƒ»æ›´æ–° | make match_force_appstore        |
| Distribution è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—       | make fetch_appstore_profiles     |
| Distribution è¨¼æ˜æ›¸ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤       | make delete_appstore_profiles    |

ä»¥ä¸‹ã‚’ Fastfile ã¸ã‚³ãƒ”ãƒšã—ã¾ã™ã€‚åˆæœŸåŒ–å¾Œã®æ—¢å­˜ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹å†…å®¹ã¯å‰Šé™¤ã—ã¦å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

- appstore_identifierï¼ˆæœ¬ç•ªç’°å¢ƒç”¨ AppIDï¼‰
- dev_identifierï¼ˆæ¤œè¨¼ç’°å¢ƒç”¨ AppIDï¼‰

ã® 2 é …ç›®ã«ã¤ã„ã¦ã¯ã€å„è‡ªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«åˆã‚ã›ã¦ãã ã•ã„ã€‚

```
# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)

platform :ios do
  def asc_api_key
    app_store_connect_api_key(
      key_id: ENV['ASC_KEY_ID'],
      issuer_id: ENV['ASC_ISSUER_ID'],
      key_content: ENV['ASC_KEY_CONTENT'],
      is_key_content_base64: true
    )
  end

  def appstore_identifier
    "your.appstore.identifier"
  end

  def dev_identifier
    "your.development.identifier"
  end

  def dev_identifiers
    [appstore_identifier, dev_identifier]
  end

  def appstore_identifiers
    [appstore_identifier]
  end

  desc "create development cert and profiles"
  lane :match_force_development do
    api_key = asc_api_key
    match(
      api_key: api_key,
      type: "development",
      app_identifier: dev_identifiers,
      force: true
    )
  end

  desc "create appstore cert and profiles"
  lane :match_force_appstore do
    api_key = asc_api_key
    match(
      api_key: api_key,
      type: "appstore",
      app_identifier: appstore_identifiers,
      force: true
    )
  end

  desc "fetch development profiles and cert"
  lane :fetch_development_profiles do
    api_key = asc_api_key
    match(
      api_key: api_key,
      type: "development",
      app_identifier: dev_identifiers,
      readonly: true
    )
  end

  desc "fetch appstore profiles and cert"
  lane :fetch_appstore_profiles do
    api_key = asc_api_key
    match(
      api_key: api_key,
      type: "appstore",
      app_identifier: appstore_identifiers,
      readonly: true
    )
  end

  desc "delete development profiles and cert"
  lane :delete_development_profiles do
    api_key = asc_api_key
    match_nuke(
      api_key: api_key,
      type: "development",
      app_identifier: dev_identifiers
    )
  end

  desc "delete appstore profiles and cert"
  lane :delete_appstore_profiles do
    api_key = asc_api_key
    match_nuke(
      api_key: api_key,
      type: "appstore",
      app_identifier: appstore_identifiers
    )
  end
end
```

## Makefile ã®ä½œæˆ

æ¯å› fastlane ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¤ã®ã¯é¢å€’ã€‚ã‹ã¤ã€æ§˜ã€…ãªå‡¦ç†ã‚’å®Ÿè¡Œã—ãŸå¾Œã« fastlane ã‚’å®Ÿè¡Œã—ãŸã„ã€‚ã¨ã„ã†å ´åˆã‚’æƒ³å®šã—ã¦ã€Makefile ã‚’ä½œæˆã—ã¾ã™ã€‚

Makefile ã¯ Xcode ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜éšå±¤ã«é…ç½®ã—ã¾ã™ã€‚ï¼ˆGemfile ã¨ã‹ã¨åŒã˜éšå±¤ï¼‰

åŸºæœ¬çš„ã«ã¯ã€make ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚‚ã‚‰ã†ã“ã¨ã¨ãªã‚Šã¾ã™ã€‚

```
FASTLANE := bundle exec fastlane

match_force_development:
	$(FASTLANE) ios match_force_development

match_force_appstore:
	$(FASTLANE) ios match_force_appstore

fetch_development_profiles:
	$(FASTLANE) ios fetch_development_profiles

fetch_appstore_profiles:
	$(FASTLANE) ios fetch_appstore_profiles

delete_development_profiles:
	$(FASTLANE) ios delete_development_profiles

delete_appstore_profiles:
	$(FASTLANE) ios delete_appstore_profiles
```

# ãŠã‚ã‚Šã«

ä»¥ä¸Šã§ã€iOS ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã® Fastlane çµ„ã¿è¾¼ã¿ãŒçµ‚ã‚ã‚Šã¾ã—ãŸã€‚

å…¨ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ Fastlane ã‚’å°å…¥ã—ã¦ã€ã‚¹ãƒˆãƒ¬ã‚¹ãƒ•ãƒªãƒ¼ãªé–‹ç™ºç’°å¢ƒã‚’ä½œã‚Šã¾ã—ã‚‡ã†ï¼
