---
title: "[Swift5] Realm5ã®ã‚ˆãä½¿ã†ã¨ã“ã‚ã ã‘ã‚’ã‚µãƒ³ãƒ—ãƒ«ä»˜ãã§ã¾ã¨ã‚ã¦ã¿ãŸ"
type: "tech"
emoji: "ğŸ“±"
topics: ["swift", "xcode", "realm"]
published: true
---

# Realm

## æ¦‚è¦

- ä¿å­˜ã§ãã‚‹å‹
  - `Bool`, `Int`, `Int8`, `Int16`, `Int32`, `Int64`, `Double`, `Float`, `String`, `Date`, `Data`.


- `CGFloat`ã§ä¿å­˜ã™ã‚‹ã“ã¨ã¯æ¨å¥¨ã•ã‚Œãªã„ï¼ˆã§ããªãã¯ãªã„ãŒå‹ãŒRealmã§ä¿è¨¼ã•ã‚Œã¦ã„ãªã„ï¼‰


- `String`,` Date`, `Data` ã¯ `Optional`æŒ‡å®š ãŒå¯èƒ½ã€‚
  ãã®ä»–ã®ä¿å­˜ã§ãã‚‹å‹ã§ `Optional`æŒ‡å®š ã‚’ã—ãŸã„å ´åˆã¯ã€`RealmOptional`ã‚’åˆ©ç”¨ã™ã‚‹ã€‚`RealmOptional`ã¯ã€Œ`Int,` `Float`, `Double`, `Bool`ã€ã«å¯¾å¿œã€‚
  `RealmOptional`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯å¿…ãš`let`ã§ãªã‘ã‚Œã°ã„ã‘ãªã„ã€‚



## RealmDatabaseã®ä½œæˆï¼ˆCREATE DATABASEï¼‰

```swift
// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
let realm = try! Realm()
 
// ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
let realm = try! Realm(fileURL: YOUR_REALM_FILE_PATH)
 
// ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã§ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«configã‚’é©ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
let configration = Realm.Configuration(inMemoryIdentifier: "ãƒ¡ãƒ¢ãƒªç©ºé–“å")
let realm = try! Realm(configration: configration) 
```



## RealmDatabaseã®å‰Šé™¤ï¼ˆDROP DATABASEï¼‰

```swift
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¾ã‚‹ã¾ã‚‹å‰Šé™¤
NSFileManager.defaultManager().removeItemAtURL(Realm.Configuration.defaultConfiguration.fileURL!)
 
// ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ®‹ã™ãŒã€ä¸­èº«ã‚’ç©ºã£ã½ã«
try! realm.write {
  realm.deleteAll()
}
```



## ãƒ¢ãƒ‡ãƒ«ã®å®šç¾©ï¼ˆCREATE TABLEï¼‰

```Swift
import RealmSwift

// Dog model
class Dog: Object {
    @objc dynamic var name = ""
    @objc dynamic var owner: Person? // Properties can be optional
}

// Person model
class Person: Object {
    @objc dynamic var name = ""
    @objc dynamic var birthdate = Date(timeIntervalSince1970: 1)
    let dogs = List<Dog>()
}
```

### ãƒ¢ãƒ‡ãƒ«ã®ç¶™æ‰¿

```swift
// Base Model
class Animal: Object {
    @objc dynamic var age = 0
}

// Models composed with Animal
class Duck: Object {
    @objc dynamic var animal: Animal? = nil
    @objc dynamic var name = ""
}
class Frog: Object {
    @objc dynamic var animal: Animal? = nil
    @objc dynamic var dateProp = Date()
}

// Usage
let duck = Duck(value: [
  "animal": [ 
    "age": 3
  ],
  "name": "Gustav"
	]
)
```



## ãƒ¢ãƒ‡ãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å±æ€§

`Realm`ãƒ¢ãƒ‡ãƒ«ã«å®šç¾©ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯`@obj dynamic var`å±æ€§ã‚’æŒãŸãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚ãŸã ã—`Swift4`ä»¥é™ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ã®ã§ãã‚‹`@objcMembers`ä¿®é£¾å­ã‚’ã‚¯ãƒ©ã‚¹ã«å®£è¨€ã—ã¦ã„ã‚‹å ´åˆã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯å˜ã«`dynamic var`å±æ€§ã§å®£è¨€ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```swift
/// Swift4 ä»¥å‰
// Dog model
class Dog: Object {
    @objc dynamic var name = ""
    @objc dynamic var owner: Person? // Properties can be optional
}

/// Swift4 ä»¥é™
// Dog model
@objcMembers
class Dog: Object {
    dynamic var name = ""
    dynamic var owner: Person? // Properties can be optional
}
```

ãŸã ã—ã€`LinkingObjects`, `List`, `RealmOptional`å±æ€§ã¯å‹•çš„ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦å®£è¨€ã™ã‚‹ã“ã¨ãŒã§ããªã„ã®ã§ã€å¸¸ã«`let`ã§å®£è¨€ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚

| Type           | Non-optional                                                             | Optional                                 |
| :------------- | :----------------------------------------------------------------------- | :--------------------------------------- |
| Bool           | `@objc dynamic var value = false`                                        | `let value = RealmOptional<Bool>()`      |
| Int            | `@objc dynamic var value = 0`                                            | `let value = RealmOptional<Int>()`       |
| Float          | `@objc dynamic var value: Float = 0.0`                                   | `let value = RealmOptional<Float>()`     |
| Double         | `@objc dynamic var value: Double = 0.0`                                  | `let value = RealmOptional<Double>()`    |
| String         | `@objc dynamic var value = ""`                                           | `@objc dynamic var value: String? = nil` |
| Data           | `@objc dynamic var value = Data()`                                       | `@objc dynamic var value: Data? = nil`   |
| Date           | `@objc dynamic var value = Date()`                                       | `@objc dynamic var value: Date? = nil`   |
| Object         | `n/a`                                                                    | `@objc dynamic var value: Class?`        |
| List           | `let value = List<Type>()`                                               | `n/a`                                    |
| LinkingObjects | `let value = LinkingObjects(fromType: Class.self, property: "property")` | `n/a`                                    |


## ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼

ãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©ã™ã‚‹æ™‚ã« `primaryKey`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹ã“ã¨ã§ã€ãƒ¢ãƒ‡ãƒ«ã®ä¸»ã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ä¸»ã‚­ãƒ¼ã‚’è¨­å®šã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’`Realm`ã«ä¿å­˜ã™ã‚‹ã¨ã€å¾Œã‹ã‚‰å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ããªã„ã€‚

```swift
class Person: Object {
    @objc dynamic var id = 0
    @objc dynamic var name = ""

    override static func primaryKey() -> String? {
        return "id"
    }
}
```



## ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

`Realm`ã§ã¯å„ãƒ¢ãƒ‡ãƒ«ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’`indexedProperties`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹ã“ã¨ã§ä½œæˆã§ãã‚‹ã€‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ç­‰å·æ¼”ç®—ã€INæ¼”ç®—ã—ã‚’ç”¨ã„ãŸã‚¯ã‚¨ãƒªã‚’é«˜é€Ÿã«å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ï¼ˆâ€» ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã™ã‚‹ãŸã‚ `Realm`ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚µã‚¤ã‚ºã¯å¤§ãããªã‚‹ï¼‰

`Realm`ã§ã¯`String`, `Int`, `Bool`, `Date`å‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«å¯¾å¿œã—ã¦ã„ã‚‹ã€‚

```swift
class Book: Object {
    @objc dynamic var price = 0
    @objc dynamic var title = ""

    override static func indexedProperties() -> [String] {
        return ["title"]
    }
}
```



## ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ç„¡è¦–

`Realm`ã«ä¿å­˜ã™ã‚‹å¿…è¦ã®ãªã„å¤‰æ•°ï¼ˆä¸€æ™‚ä½¿ç”¨ã€ä¸€æ™‚çš„ãªå¤‰æ•°ï¼‰ã‚’`ignoredProperties`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹ã“ã¨ã§è¨­å®šã§ãã‚‹ã€‚ã“ã‚Œã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦æ“ä½œã€åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãŒã€ä¿å­˜ã™ã‚‹éš›ã«ãƒ‡ãƒ¼ã‚¿ã¯ç„¡è¦–ã•ã‚Œã‚‹ã€‚ã¾ãŸã€getterã—ã‹æŒãŸãªã„å¤‰æ•°ã¯ã€è‡ªå‹•çš„ã«ãƒ¢ãƒ‡ãƒ«ä¿å­˜æ™‚ã«ç„¡è¦–ã•ã‚Œã‚‹ã€‚

```swift
class Person: Object {
    @objc dynamic var tmpID = 0
    var name: String { // read-only properties are automatically ignored
        return "\(firstName) \(lastName)"
    }
    @objc dynamic var firstName = ""
    @objc dynamic var lastName = ""

    override static func ignoredProperties() -> [String] {
        return ["tmpID"]
    }
}
```



## ãƒ¢ãƒ‡ãƒ«ã®æ›¸ãè¾¼ã¿

ãƒ¢ãƒ‡ãƒ«ã‚’æ›¸ãè¾¼ã‚€ãŸã‚ã«ã¯ã€ãƒ¢ãƒ‡ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦`Realm`ã«è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```swift
class Dog: Object {
    @objc dynamic var name = ""
    @objc dynamic var age = 0
}

// (1) Create a Dog object and then set its properties
var myDog = Dog()
myDog.name = "Rex"
myDog.age = 10

// (2) Create a Dog object from a dictionary
let myOtherDog = Dog(value: ["name" : "Pluto", "age": 3])

// (3) Create a Dog object from an array
let myThirdDog = Dog(value: ["Fido", 5])
```

1. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ãŸå¾Œã€ç›´æ¥ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¯¾ã—ã¦å€¤ã‚’ä»£å…¥ã—ã¦ä½œæˆã™ã‚‹æ–¹æ³•
2. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹éš›ã«`Dictionary`ã‚’ç”¨ã„ã¦ã€åˆæœŸåŒ–ã—ã¦ä½œæˆã™ã‚‹æ–¹æ³•
3. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹éš›ã«`Array`ã‚’ç”¨ã„ã¦ã€åˆæœŸåŒ–ã—ã¦ä½œæˆã™ã‚‹æ–¹æ³•
   ï¼ˆâ€» ã“ã®å ´åˆã€é…åˆ—å†…è¦ç´ ã®ä¸¦ã³ã¯ãƒ¢ãƒ‡ãƒ«ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸¦ã³ã¨åŒã˜ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚ã¾ãŸãƒ¢ãƒ‡ãƒ«ä¿å­˜æ™‚ã«ç„¡è¦–ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚„getterã®ã¿ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãªã©ã¯ç„¡è¦–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼‰

ãƒ¢ãƒ‡ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆå¾Œã€`Realm`ã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```swift
// Get the default Realm
let realm = try! Realm()
// You only need to do this once (per thread)

// Add to the Realm inside a transaction
try! realm.write {
    realm.add(myDog)
}
```

`Realm`ã¸ã®æ›¸ãè¾¼ã¿ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒçµ‚äº†ã™ã‚‹ã¨ã€ä»–ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚‚è¿½åŠ ã—ãŸå€¤ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚ã“ã®ã¨ãã€è¤‡æ•°ã®æ›¸ãè¾¼ã¿ãŒåŒæ™‚é€²è¡Œã§ç™ºç”Ÿã—ãŸå ´åˆã¯ã€ä»–æ–¹ã®æ›¸ãè¾¼ã¿ãŒçµ‚ã‚ã‚‹ã¾ã§ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã€‚ã“ã‚Œã«ã‚ˆã£ã¦**æ›¸ãè¾¼ã¿ãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã‚‚ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹**ã“ã¨ã‚’æ³¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ãŸã ã—ã€æ›¸ãè¾¼ã¿ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒçµ‚äº†ã—ã¦ã„ãªã„å ´åˆã§ã‚ã£ã¦ã‚‚ã€èª­ã¿è¾¼ã¿ã¯å¯èƒ½ã§ã‚ã‚‹ã€‚



## ãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°

ãƒ¢ãƒ‡ãƒ«æ›´æ–°ã®æ–¹æ³•ã¯è¤‡æ•°ã‚ã‚‹ã€‚

```swift
let author = ....
// Update an object with a transaction
try! realm.write {
    author.name = "Thomas Pynchon"
}
```

```swift
let persons = realm.objects(Person.self)
try! realm.write {
    persons.first?.setValue(true, forKey: "isFirst")
    // set each person's planet property to "Earth"
    persons.setValue("Earth", forKey: "planet")
}
```

ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆã¯ã€ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã«ã‚ˆã‚‹æ›´æ–°ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã€‚

```swift
// Creating a book with the same primary key as a previously saved book
let cheeseBook = Book()
cheeseBook.title = "Cheese recipes"
cheeseBook.price = 9000
cheeseBook.id = 1

// Updating book with id = 1
try! realm.write {
    realm.add(cheeseBook, update: .modified)
}
```

ã“ã®æ™‚ã€ä¸»ã‚­ãƒ¼ï¼ˆid: 1ï¼‰ãŒã™ã§ã«å­˜åœ¨ã—ã¦ã„ã‚Œã°å˜ã«æ›´æ–°å‡¦ç†ãŒèµ°ã‚‹ã€‚ä¸»ã‚­ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ `create` ã¨åŒç­‰ã®å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚ã¾ãŸã€ä¸»ã‚­ãƒ¼ã¨æ›´æ–°ã—ãŸã„å€¤ã®ã‚µãƒ–ã‚»ãƒƒãƒˆã‚’å¼•æ•°ã«ã™ã‚‹ã“ã¨ã§å·®åˆ†æ›´æ–°ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã€‚

```swift
// Assuming a "Book" with a primary key of `1` already exists.
try! realm.write {
    realm.create(Book.self, value: ["id": 1, "price": 9000.0], update: .modified)
    // the book's `title` property will remain unchanged.
}
```

ãŸã ã—ã€ä¸»ã‚­ãƒ¼ã‚’å®šç¾©ã—ã¦ã„ãªã„ãƒ¢ãƒ‡ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›´æ–°ã™ã‚‹å ´åˆã«ã¯ `update:` ã®å¼•æ•°ã« `.modified`, `.all` ã‚’æ¸¡ã™ã“ã¨ãŒã§ããªã„ã€‚ã¾ãŸã€`.modified`,  `.all`ã‚’ä½¿ã£ãŸå¤šé‡ï¼ˆã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ãªï¼‰æ›¸ãè¾¼ã¿ã®çµæœã«ã¯æ³¨æ„ãŒå¿…è¦ã€‚

```swift
/// current DB recode
Book: ["id": 1, title: "Cheese recipes" "price": 9000.0]

/// create some write transactions ( cause conflict ï¼‰
Book: ["id": 1, title: "Fruit recipes", price: 9000], update: .all
Book: ["id": 1, title: "Cheese recipes", price: 4000], update: .all
```

ã“ã®å ´åˆã€ï¼’ã¤ã®æ›´æ–°ãŒåŒæ™‚ã«ç™ºç”Ÿã™ã‚‹ãŸã‚ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãŒç™ºç”Ÿã™ã‚‹ã€‚ã“ã‚Œã‚‰ã®æ›¸ãè¾¼ã¿ãŒãƒãƒ¼ã‚¸ã•ã‚ŒãŸçµæœã¨ã—ã¦å¾—ã‚‰ã‚Œã‚‹çµæœã¯ã€ä»¥ä¸‹ã®ã©ã¡ã‚‰ã‹ã¨ãªã‚‹ã€‚

```swift
Book: ["id": 1, title: "Fruit recipes", price: 9000]
Book: ["id": 1, title: "Cheese recipes", price: 4000]
```

ã—ã‹ã—`update: .modified`ã¨ã—ãŸå ´åˆã¯ã€æŒ™å‹•ãŒå¤‰ã‚ã‚‹ã€‚

```swift
/// current DB recode
Book: ["id": 1, title: "No.4" "price": 9000.0]

/// create some write transactions ( cause conflict ï¼‰
Book: ["id": 1, title: "Fruit recipes", price: 9000], update: .modified
Book: ["id": 1, title: "Cheese recipes", price: 4000], update: .modified
```

ã“ã®å ´åˆã®æ›¸ãè¾¼ã¿ãŒãƒãƒ¼ã‚¸ã•ã‚ŒãŸçµæœã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹

```swift
Book: ["id": 1, title: "Fruit recipes", price: 4000]
```

`.all`  ã¯å®Œå…¨ç½®ãæ›ãˆã€`.modified` ã¯å·®åˆ†ç½®ãæ›ãˆã§ã‚ã‚‹ã“ã¨ã‚’æ³¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚



## ãƒ¢ãƒ‡ãƒ«ã®å‰Šé™¤

æ›¸ãè¾¼ã¿ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸­ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

```swift
// let cheeseBook = ... Book stored in Realm

// Delete an object with a transaction
try! realm.write {
    realm.delete(cheeseBook)
}

// Delete all objects from the realm
try! realm.write {
    realm.deleteAll()
}
```



## ãƒ¢ãƒ‡ãƒ«ã®å¤‰æ›´é€šçŸ¥

`Realm`ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯è‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œã‚‹ã€‚ã¤ã¾ã‚Šã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã—ã¦ã„ã‚‹ä»–ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã€ãã®å¤‰æ›´ãŒå³åº§ã«åæ˜ ã•ã‚Œã‚‹ã€‚`Realm`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°é€šçŸ¥ã‚’è³¼èª­ã™ã‚‹ã“ã¨ã§ã€å¯¾è±¡ã®`Realm`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã«é€šçŸ¥ã‚’å–å¾—ã§ãã‚‹ã€‚

```swift
/// Model
class StepCounter: Object {
    @objc dynamic var steps = 0
}

/// Realm Object
let stepCounter = StepCounter()
let realm = try! Realm()
try! realm.write {
    realm.add(stepCounter)
}

/// NotificationToken
var token : NotificationToken?
token = stepCounter.observe { change in
    switch change {
      
      /// Realm Object is change
    	case .change(let properties):
      	for property in properties {
        	if property.name == "steps" && property.newValue as! Int > 1000 {
          	print("Congratulations, you've exceeded 1000 steps.")
            token = nil
          }
        }
      
      /// Realm Object cause error
    	case .error(let error):
        print("An error occurred: \(error)")
      
      /// Realm Object was deleted
    	case .deleted:
        print("The object was deleted.")
    }
}
```



## ãƒ¢ãƒ‡ãƒ«é–“ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

- **1:N, N:1**

```swift
// Dog model
class Dog: Object {
    @objc dynamic var name = ""
    @objc dynamic var owner: Person? // Properties can be optional
}

// Person model
class Person: Object {
    @objc dynamic var name = ""
    @objc dynamic var birthdate = Date(timeIntervalSince1970: 1)
    let dogs = List<Dog>()
}

/// to-one relation
let jim = Person()
let rex = Dog()
rex.owner = jim

/// Many-to-one
let someDogs = realm.objects(Dog.self).filter("name contains 'Fido'")
jim.dogs.append(objectsIn: someDogs)
jim.dogs.append(rex)
```

- **åŒæ–¹å‘ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**  
  ä¸€èˆ¬çš„ã«ãƒ¢ãƒ‡ãƒ«åŒå£«ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒªãƒ³ã‚¯ã•ã‚Œã¦ã‚‹å´ã‹ã‚‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã¯ã§ãã‚‹ãŒã€é€†æ–¹å‘ã‹ã‚‰ã¯è¾¿ã‚‹ã“ã¨ãŒã§ããªã„ã€‚`Realm`ã§ã¯`LinkingObjects`ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€åŒæ–¹å‘ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å½¢æˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚`LinkingObjects`ã¯ç‰¹å®šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆã“ã“ã§ã¯Personãƒ¢ãƒ‡ãƒ«ã®dogsãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ã‹ã‚‰ä¸ãˆã‚‰ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒªãƒ³ã‚¯ã•ã‚Œã¦ã„ã‚‹**ã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```swift
class Dog: Object {
    @objc dynamic var name = ""
    @objc dynamic var age = 0
    let owners = LinkingObjects(fromType: Person.self, property: "dogs")
}
```



## Appendix

### JSONã«ã‚ˆã‚‹Recordä½œæˆ

`Realm` ã¯ç›´æ¥JSONã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ãŒã€`JSONSerialization` ã®å‡ºåŠ›ã‚’ç”¨ã„ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚JSONå†…ã«ãƒã‚¹ãƒˆã•ã‚Œã¦ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„é…åˆ—ã¯ã€è‡ªå‹•çš„ã«ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ã“ã®æ–¹æ³•ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã¨ãã«ã¯ã€ã„ãã¤ã‹ã®æ³¨æ„ç‚¹ãŒå­˜åœ¨ã™ã‚‹ã€‚

- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¨JSONã®ã‚­ãƒ¼åãŒä¸€è‡´ã—ã¦ã€å‹ãŒåŒã˜ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- floatãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€floatã‚’ãƒãƒƒã‚¯ã«ã—ãŸNSNumbersã§åˆæœŸåŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- Dateãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨Dataãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯æ–‡å­—åˆ—ã‹ã‚‰è‡ªå‹•çš„ã«æ¨è«–ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒã€Realm().create(_:value:update:)ã«æ¸¡ã™å‰ã«é©åˆ‡ãªå‹ã«å¤‰æ›ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

- å¿…é ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã« JSON NULL (ã™ãªã‚ã¡ NSNull) ãŒä¸ãˆã‚‰ã‚ŒãŸå ´åˆã€ä¾‹å¤–ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã¾ã™ã€‚

- insert æ™‚ã«å¿…é ˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä¸ãˆã‚‰ã‚Œãªã„å ´åˆã¯ã€ä¾‹å¤–ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã¾ã™ã€‚

- Realmã¯ã€Objectã§å®šç¾©ã•ã‚Œã¦ã„ãªã„JSONå†…ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç„¡è¦–ã—ã¾ã™ã€‚

```swift
// A Realm Object that represents a city
class City: Object {
    @objc dynamic var name = ""
    @objc dynamic var cityId = 0
    // other properties left out ...
}

let data = "{\"name\": \"San Francisco\", \"cityId\": 123}".data(using: .utf8)!
let realm = try! Realm()

// Insert from Data containing JSON
try! realm.write {
    let json = try! JSONSerialization.jsonObject(with: data, options: [])
    realm.create(City.self, value: json, update: .modified)
}
```



### ãƒ¢ãƒ‡ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–°æ™‚ã®è¨­å®š

`Realm` ã§ã¯ `Realm` ã«æ›¸ãè¾¼ã¾ã‚ŒãŸã‹å¦ã‹ã§ã€æ›´æ–°æ–¹æ³•ãŒå¤‰ã‚ã‚‹å ´åˆãŒã‚ã‚‹ã€‚

- **ã‚¢ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**   
`Realm` ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹å‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ `realm.write` ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã®å¤–ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã§ãã‚‹ï¼‰ 
- **ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**  
`Realm` ã«æ›¸ãè¾¼ã¾ã‚ŒãŸå¾Œã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ï¼ˆ`realm.write` ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã®å¤–ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã§ããªã„ï¼‰

```swift
@IBAction func tappedButton(_ sender: Any) {
   
  /*
   * ã“ã®æ™‚ç‚¹ã®personã¯Realmã«æ›¸ãè¾¼ã¾ã‚Œã¦ã„ãªã„ã®ã§ã‚¢ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
   */
  let person = Person(value: ["name": "Yu", "age": 32])
  
  // æ›¸ãè¾¼ã¾ã‚Œã¦ã„ãªã„ã®ã§ã€realm.writeå†…ã§ãªãã¦ã‚‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ›´æ–°ã¯å•é¡Œãªã—
  person.mood = "Happy" 

  do {
      let realm = try Realm()
      try! realm.write {
        realm.add(person) // Personã‚’Realmã«ä¿å­˜ã—ãŸã“ã¨ã§ã€ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãªã‚‹
        print("1å›ç›®æˆåŠŸã ã‚ˆ", person)
      }
  } catch {
      print("ã‚¨ãƒ©ãƒ¼ã ã‚ˆ")
  }
  
  /*
   * ã“ã®æ™‚ç‚¹ã®Personã¯ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ›´æ–°ã¯realm.writeå†…ã®ã¿å¯èƒ½
   */
  
  // person.mood = "sad" // ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹
  do {
      let realm = try Realm()
      try! realm.write {
          person.mood = "Sad" // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ›´æ–°
          print("2å›ç›®æˆåŠŸã ã‚ˆ", person)
      }
  } catch {
      print("ã‚¨ãƒ©ãƒ¼ã ã‚ˆ")
  }
}
```

ä¸€èˆ¬çš„ã«ã¯ã€ã“ã®ã‚ˆã†ã«åˆ†é›¢ã—ã¦å‡¦ç†ã‚’å¤‰æ›´ã™ã‚‹ã¹ãã§ã‚ã‚‹ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚

```swift
@IBAction func tappedButton(_ sender: Any) {
   
  /*
   * ã“ã®æ™‚ç‚¹ã®personã¯Realmã«æ›¸ãè¾¼ã¾ã‚Œã¦ã„ãªã„ã®ã§ã‚¢ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
   */
  let person = Person(value: ["name": "Yu", "age": 32])
  
  // æ›¸ãè¾¼ã¾ã‚Œã¦ã„ãªã„ã®ã§ã€realm.writeå†…ã§ãªãã¦ã‚‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ›´æ–°ã¯å•é¡Œãªã—
  person.mood = "Happy" 

  do {
      let realm = try Realm()
      try! realm.write {
        realm.add(person, updated: .modified) // Personã‚’Realmã«ä¿å­˜ã—ãŸã“ã¨ã§ã€ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãªã‚‹
        print("1å›ç›®æˆåŠŸã ã‚ˆ", person)
      }
  } catch {
      print("ã‚¨ãƒ©ãƒ¼ã ã‚ˆ")
  }
  
  /*
   * ã“ã®æ™‚ç‚¹ã®Personã¯ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ›´æ–°ã¯realm.writeå†…ã®ã¿å¯èƒ½
   */
  
  // person.mood = "sad" // ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹
  do {
      let realm = try Realm()
      try! realm.write {
          realm.add(person, updated: .modified) "Sad" // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ›´æ–°
          print("2å›ç›®æˆåŠŸã ã‚ˆ", person)
      }
  } catch {
      print("ã‚¨ãƒ©ãƒ¼ã ã‚ˆ")
  }
}
```