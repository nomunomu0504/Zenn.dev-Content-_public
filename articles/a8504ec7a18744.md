---
title: "å†å¸°ä¸‹é™æ³•ã§Cè¨€èªæ•°å¼ãƒ‘ãƒ¼ã‚µãƒ¼ã‚‚ã©ãã‚’ä½œã£ã¦ã¿ã‚‹"
emoji: "ğŸš—"
topics: ["æ§‹æ–‡è§£æ", "C", "ãƒ‘ãƒ¼ã‚µãƒ¼", "lex", "yacc"]
type: "tech"
published: true
---

## ç›®çš„
ä»Šå›ã®ç›®çš„ã¯ã€æ•°å¼ã®æ§‹æ–‡è§£æã‚’è¡Œã†ã“ã¨ã®ã§ãã‚‹ã€ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’ä½œã‚‹ã“ã¨ã§ã™ã€‚æœ€è¿‘ã§ã¯ã€æ§‹æ–‡è§£æã‚’ä½œæˆã™ã‚‹éš›ã«ã¯lex+yaccï¼ˆflex+bisonï¼‰ãªã©ã‚’ç”¨ã„ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ãŒã€ä»Šå›ã¯å†å¸°ä¸‹é™æ³•ã‚’ç”¨ã„ãŸãƒ‘ãƒ¼ã‚µãƒ¼ã‚’ä½œã‚Šã¾ã™ã€‚ãŸã ã€å¯¾å¿œã§ãã¦ã„ãªã„éƒ¨åˆ†ãªã©ã‚‚ãªã‚‹ã®ã§ã€ã‚³ãƒ¡ãƒ³ãƒˆãªã©ã§å¯¾ç­–ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨ã‚ã‚ŠãŒãŸã„ã§ã™...ã€‚
â€‹
åŸºæœ¬çš„ãªæµã‚Œã¨ã—ã¦ã¯ã€BNFè¨˜æ³•ã«åŸºã¥ã„ã¦è¨€èªã®æ–‡æ³•ã‚’è¡¨ç¾ã—ã¦ã‹ã‚‰ã€ãã‚Œã‚’ã‚³ãƒ¼ãƒ‰ã«è½ã¨ã—è¾¼ã¿ã¾ã™ã€‚
â€‹
## BNFï¼ˆãƒãƒƒã‚«ã‚¹ãƒŠã‚¦ã‚¢è¨˜æ³•ï¼‰
æ§‹æ–‡è§£æã‚’è¡Œã†ã«ã‚ãŸã£ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªBNFæ–‡æ³•ã‚’ä½œæˆã—ã¾ã—ãŸ
â€‹
```cpp
/**
 * ãƒãƒƒã‚«ã‚¹ãƒŠã‚¦ã‚¢è¨˜æ³•(BNF)
 *
 * ## å¼ã¯é …ã®ã¿ or (+, -)æ¼”ç®—å­ã‚’å«ã‚€å¼ ##
 * expr ::= term
 *        | term '+' expr
 *        | term '-' expr
 *        ;
 *
 * ## é …ã¯å› å­ or (*, /)æ¼”ç®—å­ã‚’å«ã‚€é … ##
 * term ::= factor
 *        | factor '*' term
 *        | factor '/' term
 *        ;
 *
 * ## å› å­ã¯æ•°å€¤ or ã‚«ãƒƒã‚³ã‚’å«ã‚€ï¼ˆå¼, é …ï¼‰or æ¼”ç®—å­ã‚’å«ã‚€##
 * factor ::= DIGIT
 *          | VARIABLE
 *          | VARIABLE OPERATOR expr
 *          | '(' expr ')'
 *          ;
 *
 * ## æ•°å€¤ ##
 * DIGIT ::= [0-9]+ ;
 *
 * ## å¤‰æ•°å ##
 * VARIABLE ::= _a-zA-Z [_a-zA-Z0-9]+ ;
 *
 * ## æ¼”ç®—å­ ##
 * OPERATOR ::= '='
 */
```
â€‹
## å†å¸°ä¸‹é™ãƒ‘ãƒ¼ã‚µ
### expr
```cpp
/**
 * ## å¼ã¯é …ã®ã¿ or (+, -)æ¼”ç®—å­ã‚’å«ã‚€å¼ ##
 * expr ::= term
 *        | term '+' expr
 *        | term '-' expr
 *        ;
 *
 * @param pc   è§£æã™ã‚‹æ–‡å­—åˆ—ã®å…ˆé ­
 * @param endp è§£æãŒçµ‚ã‚ã£ãŸå ´æ‰€
 * @return     è¨ˆç®—çµæœ
 */
int expr( const char* pc, const char** endp ) {
â€‹
    // 1æ–‡å­—ç›®ï¼ˆå¿…ãštermã«å±ã™ã‚‹ï¼‰ã‚’å–å¾—ã™ã‚‹
    int left = term( pc, endp );
â€‹
    while( true ) {
        if ('+' == **endp)
        {
            // ï¼‹1ã¯ '+' åˆ†ãšã‚‰ã™
            int right = expr( *endp + 1, endp );
            return left + right;
        }
        else if ('-' == **endp)
        {
            // ï¼‹1ã¯ '-' åˆ†ãšã‚‰ã™
            int right = expr( *endp + 1, endp );
            return left - right;
        }
        else if (isspace(**endp))
        {
            *endp += 1;
        } else { break; }
    }
    return left;
}
```
â€‹
### term
```cpp
/**
 * ## é …ã¯å› å­ or (*, /, '%')æ¼”ç®—å­ã‚’å«ã‚€é … ##
 * term ::= factor
 *        | factor '*' term
 *        | factor '/' term
 *        | factor '%' term
 *        ;
 *
 * @param pc   è§£æã™ã‚‹æ–‡å­—åˆ—ã®å…ˆé ­
 * @param endp è§£æãŒçµ‚ã‚ã£ãŸå ´æ‰€
 * @return     è¨ˆç®—çµæœ
 */
int term( const char* pc, const char** endp ) {
â€‹
    // 1æ–‡å­—ç›®ï¼ˆå¿…ãšfactorã«å±ã™ã‚‹ï¼‰ã‚’å–å¾—ã™ã‚‹
    int left = factor( pc, endp );
â€‹
    while( true ) {
        if ('*' == **endp)
        {
            // ï¼‹1ã¯ '*' åˆ†ãšã‚‰ã™
            int right = term( *endp + 1, endp );
            return left * right;
        }
        else if ('/' == **endp)
        {
            // ï¼‹1ã¯ '/' åˆ†ãšã‚‰ã™
            int right = term( *endp + 1, endp );
            return left / right;
        }
        else if ('%' == **endp)
        {
            // ï¼‹1ã¯ '%' åˆ†ãšã‚‰ã™
            int right = term( *endp + 1, endp );
            return left % right;
        }
        else if (isspace(**endp))
        {
            *endp += 1;
        }
        else { break; }
    }
    return left;
}
```
â€‹
### factor
```cpp
/**
 * ## å› å­ã¯æ•°å€¤ or ã‚«ãƒƒã‚³ã‚’å«ã‚€ï¼ˆå¼, é …ï¼‰or æ¼”ç®—å­ã‚’å«ã‚€##
 * factor ::= DIGIT
 *          | VARIABLE
 *          | VARIABLE OPERATOR expr
 *          | '(' expr ')'
 *          ;
 *
 * @param pc   è§£æã™ã‚‹æ–‡å­—åˆ—ã®å…ˆé ­
 * @param endp è§£æãŒçµ‚ã‚ã£ãŸå ´æ‰€
 * @return     è¨ˆç®—çµæœ
 */
int factor( const char* pc, const char** endp ) {
â€‹
    *endp = pc;
â€‹
    switch(**endp) {
        case '(': {
            // ã‚«ãƒƒã‚³åˆ†èª­ã¿é£›ã°ã—
            *endp += 1;
â€‹
            // ã‚«ãƒƒã‚³å†…ã®å¼ã‚’è§£æ
            int innerExprValue = expr( *endp, endp );
â€‹
            // ã‚«ãƒƒã‚³ã®çµ‚ã‚ã‚Šã¾ã§ãƒã‚¤ãƒ³ã‚¿ã‚’é€²ã‚ã‚‹
            while( true ) {
                if (')' == **endp) break;
                *endp += 1;
            }
â€‹
            pc = *endp + 1;
            return innerExprValue + expr(pc, endp);
        }
â€‹
        default:
            return digit( pc, endp );
    }
}
```
â€‹
### DIGIT
```cpp
/**
 * ## æ•°å€¤ ##
 * DIGIT ::= [0-9]+
 *         ;
 *
 * @param pc
 * @param endp
 * @return
 */
int digit( const char* pc, const char** endp ) {
â€‹
    // æ•°å€¤æ–‡å­—åˆ—ã®å¤‰æ•°
    string number;
â€‹
    *endp = pc;
â€‹
    // æ•°å­—ãŒç¶šãã ã‘ç¶šã‘ã‚‹
    while ( true ) {
        if ( isdigit(**endp) )
        {
            // æ–‡å­—åˆ—ã«è¿½åŠ 
            number.push_back(**endp);
            // ã‚«ã‚¦ãƒ³ã‚¿ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
            *endp += 1;
        }
        else if ( isspace(**endp) )
        {
            *endp += 1;
        }
        else if ( ('_' == **endp) || isalnum(**endp) ) {
            return variable( pc, endp );
        }
        else break;
    }
â€‹
    // æ•°å€¤æ–‡å­—åˆ—ãŒç©ºã‹ã©ã†ã‹
    if (number.empty()) {
        // ç©ºãªã‚‰0ã‚’è¿”ã™
        return 0;
    } else {
        // 0ä»¥å¤–ã¯æ•°å€¤ã‚’è¿”ã™
        return stoi(number);
    }
}
```
â€‹
### VARIABLE, OPERATOR
```cpp
/**
 * ## å¤‰æ•°å ##
 * VARIABLE ::= _a-zA-Z [_a-zA-Z0-9]+ ;
 */
int variable( const char* pc, const char** endp ) {
â€‹
    // å¤‰æ•°åã®å–å¾—
    string name;
â€‹
    *endp = pc;
â€‹
    // å¤‰æ•°åã‚’ï¼‘æ–‡å­—ãšã¤å–å¾—
    while ( true ) {
â€‹
        // å¤‰æ•°åã‹ã©ã†ã‹
        if (isdigit(*pc)) {
            printf("Error. variant first letter must not number.");
            exit(0);
        }
â€‹
        if ( ('_' == **endp) || isalnum(**endp) )
        {
            // æ–‡å­—åˆ—ã«è¿½åŠ 
            name.push_back(**endp);
            *endp += 1;
        }
        else if ( isspace(**endp) ) {
            *endp += 1;
        }
        else break;
    }
â€‹
    // å¤‰æ•°åãŒç©ºã‹ã©ã†ã‹
    if (name.empty()) {
        //ã€€ç©ºãªã‚‰0ã‚’è¿”ã—ã¦ãŠã
        return 0;
    }
    else {
        if ('=' == **endp) {
            // '='ã®åˆ†ã‚’é€²ã‚ã‚‹
            *endp += 1;
            pc = *endp;
            int result = expr(pc, endp);
            varStack[name] = result;
            return varStack[name];
        }
        else
        {
            // å¤‰æ•°ã‚¹ã‚¿ãƒƒã‚¯ã«ã‚­ãƒ¼[name]ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„
            if (varStack.find(name) == varStack.end() ) {
                printf("Variant %s is undefined.\n", name.c_str());
            } else {
                // ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹
                return varStack[name];
            }
        }
    }
}
```
â€‹
### è¡¨ç¤ºé–¢æ•°
```cpp
/**
 *
 * @param p0 è¨ˆç®—çµæœ
 * @param p1 è¨ˆç®—æœŸå¾…å€¤
 */
void print(int ExpectedValue, int CalculatedValue) {
    printf("Result: %s\n"
           "    -- ExpectedValue: %d, CalculatedValue: %d\n",
            (CalculatedValue == ExpectedValue) ? "True" : "False",
            ExpectedValue,
            CalculatedValue);
}
```
â€‹
## æ¤œè¨¼
```cpp
int main() {
    // è¨ˆç®—çµæœä¿æŒå¤‰æ•°
    int res;
â€‹
    // ä¸€æ‹¬ä»£å…¥ï¼ˆå³çµåˆã®ç¢ºèªï¼‰
    const char *test = nullptr;
    expr("tx = ty = tz = 6", &test);
    printf("\n== ä¸€æ‹¬ä»£å…¥ï¼ˆå³çµåˆã®ç¢ºèªï¼‰tx ==\n");
    test = nullptr;
    res = expr("tx", &test);
    print(6, res);
    printf("\n== ä¸€æ‹¬ä»£å…¥ï¼ˆå³çµåˆã®ç¢ºèªï¼‰ty ==\n");
    test = nullptr;
    res = expr("ty", &test);
    print(6, res);
    printf("\n== ä¸€æ‹¬ä»£å…¥ï¼ˆå³çµåˆã®ç¢ºèªï¼‰tz ==\n");
    test = nullptr;
    res = expr("tz", &test);
    print(6, res);
â€‹
    // 20 - å˜ç´”ãªè¨ˆç®— : OK
    printf("\n== å˜ç´”ãªè¨ˆç®— ==\n");
    const char *one = nullptr;
    res = expr("1+2*5+9", &one);
    print(20, res);
â€‹
    // 100 - è¤‡æ•°æ¡ã®å˜ç´”ãªè¨ˆç®— : OK
    printf("\n== è¤‡æ•°æ¡ã®å˜ç´”ãªè¨ˆç®— ==\n");
    const char *two = nullptr;
    res = expr("10+20+10+30*2", &two);
    print(100, res);
â€‹
    // 35 - ã‚«ãƒƒã‚³ã‚’å«ã‚€è¨ˆç®— : OK
    printf("\n== ã‚«ãƒƒã‚³ã‚’å«ã‚€è¨ˆç®— ==\n");
    const char *three = nullptr;
    res = expr("(2*5)+5*2+15", &three);
    print(35, res);
â€‹
    // 50 - è¤‡æ•°ã®ã‚«ãƒƒã‚³ã‚’å«ã‚€è¨ˆç®— : OK
    printf("\n== è¤‡æ•°ã®ã‚«ãƒƒã‚³ã‚’å«ã‚€è¨ˆç®— ==\n");
    const char *four = nullptr;
    res = expr("(2*5)+2*(5+15)", &four);
    print(50, res);
â€‹
    // 20 - ç©ºç™½ã‚’å«ã‚€å˜ç´”ãªè¨ˆç®— : OK
    printf("\n== ç©ºç™½ã‚’å«ã‚€å˜ç´”ãªè¨ˆç®— ==\n");
    const char *five = nullptr;
    res = expr("1 + 2 * 5 + 9", &five);
    print(20, res);
â€‹
    // TODO: ãƒã‚¹ãƒˆã•ã‚Œã¦ã‚‹ã¨å‹•ã‹ãªã„
    // 50 - ã‚«ãƒƒã‚³ã«ã‚«ãƒƒã‚³ãŒå«ã¾ã‚Œã‚‹è¨ˆç®— : NG
    printf("\n== ã‚«ãƒƒã‚³ã«ã‚«ãƒƒã‚³ãŒå«ã¾ã‚Œã‚‹è¨ˆç®— ==\n");
    const char *six = nullptr;
    res = expr("(5+(1+2*2))*5", &six);
    print(50, res);
â€‹
    // 7 - å‰°ä½™æ¼”ç®—å­ã‚’å«ã‚€è¨ˆç®— : OK
    printf("\n== å‰°ä½™æ¼”ç®—å­ã‚’å«ã‚€è¨ˆç®— ==\n");
    const char *seven = nullptr;
    res = expr("5 + 5 % 3", &seven);
    print(7, res);
â€‹
    // 5 - è¤‡æ•°ã®å¤‰æ•°ãŒè¤‡æ•°å€‹ã‚’å«ã‚“ã è¨ˆç®— : OK
    printf("\n== è¤‡æ•°ã®å¤‰æ•°ãŒè¤‡æ•°å€‹ã‚’å«ã‚“ã è¨ˆç®— ==\n");
â€‹
    const char *eight = nullptr;
    expr("a = 3", &eight);
    eight = nullptr;
    expr("b = 2", &eight);
â€‹
    eight = nullptr;
    res = expr("a+b", &eight);
    print(5, res);
â€‹
    // 8 - è¤‡æ•°ã®å¤‰æ•°ãŒè¤‡æ•°å€‹ã‚’å«ã‚“ã è¨ˆç®— : OK
    printf("\n== è¤‡æ•°ã®å¤‰æ•°ãŒè¤‡æ•°å€‹ã‚’å«ã‚“ã è¨ˆç®— ==\n");
â€‹
    const char *nine = nullptr;
    expr("c = b", &nine);
    nine = nullptr;
    expr("d = 1", &nine);
â€‹
    nine = nullptr;
    res = expr("a+b+c+d", &nine);
    print(8, res);
â€‹
    // 8 - è¤‡æ•°æ–‡å­—ã®å¤‰æ•°ã‚’å«ã‚“ã è¨ˆç®— : OK
    printf("\n== è¤‡æ•°æ–‡å­—ã®å¤‰æ•°ã‚’å«ã‚“ã è¨ˆç®— ==\n");
â€‹
    const char *ten = nullptr;
    expr("nomunomu0504 = 1", &ten);
    ten = nullptr;
    res = expr("9+nomunomu0504", &ten);
    print(10, res);
â€‹
    return 0 ;
}
```
â€‹
```cpp
== ä¸€æ‹¬ä»£å…¥ï¼ˆå³çµåˆã®ç¢ºèªï¼‰tx ==
Result: True
-- ExpectedValue: 6, CalculatedValue: 6
â€‹
== ä¸€æ‹¬ä»£å…¥ï¼ˆå³çµåˆã®ç¢ºèªï¼‰ty ==
Result: True
-- ExpectedValue: 6, CalculatedValue: 6
â€‹
== ä¸€æ‹¬ä»£å…¥ï¼ˆå³çµåˆã®ç¢ºèªï¼‰tz ==
Result: True
-- ExpectedValue: 6, CalculatedValue: 6
â€‹
== å˜ç´”ãªè¨ˆç®— ==
Result: True
-- ExpectedValue: 20, CalculatedValue: 20
â€‹
== è¤‡æ•°æ¡ã®å˜ç´”ãªè¨ˆç®— ==
Result: True
-- ExpectedValue: 100, CalculatedValue: 100
â€‹
== ã‚«ãƒƒã‚³ã‚’å«ã‚€è¨ˆç®— ==
Result: True
-- ExpectedValue: 35, CalculatedValue: 35
â€‹
== è¤‡æ•°ã®ã‚«ãƒƒã‚³ã‚’å«ã‚€è¨ˆç®— ==
Result: True
-- ExpectedValue: 50, CalculatedValue: 50
â€‹
== ç©ºç™½ã‚’å«ã‚€å˜ç´”ãªè¨ˆç®— ==
Result: True
-- ExpectedValue: 20, CalculatedValue: 20
â€‹
== ã‚«ãƒƒã‚³ã«ã‚«ãƒƒã‚³ãŒå«ã¾ã‚Œã‚‹è¨ˆç®— ==
Result: False
-- ExpectedValue: 50, CalculatedValue: 10
â€‹
== å‰°ä½™æ¼”ç®—å­ã‚’å«ã‚€è¨ˆç®— ==
Result: True
-- ExpectedValue: 7, CalculatedValue: 7
â€‹
== è¤‡æ•°ã®å¤‰æ•°ãŒè¤‡æ•°å€‹ã‚’å«ã‚“ã è¨ˆç®— ==
Result: True
-- ExpectedValue: 5, CalculatedValue: 5
â€‹
== è¤‡æ•°ã®å¤‰æ•°ãŒè¤‡æ•°å€‹ã‚’å«ã‚“ã è¨ˆç®— ==
Result: True
-- ExpectedValue: 8, CalculatedValue: 8
â€‹
== è¤‡æ•°æ–‡å­—ã®å¤‰æ•°ã‚’å«ã‚“ã è¨ˆç®— ==
Result: True
-- ExpectedValue: 10, CalculatedValue: 10
```
â€‹
## è§£èª¬
ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸€å¼ã¯ã“ã“ã«ç½®ã„ã¦ãŠãã¾ã™ã€‚
â€‹
[å†å¸°ä¸‹é™æ³•ã‚’ç”¨ã„ãŸCè¨€èªæ•°å¼ãƒ‘ãƒ¼ã‚µãƒ¼ã‚‚ã©ã - Github](https://gist.github.com/nomunomu0504/b36f1ae76263f20808515cbf41fb3523)
â€‹
åŸºæœ¬çš„ãªè¨ˆç®—å¼ã¯è¨ˆç®—ã§ãã‚‹ã‚ˆã†ã§ã™ï¼ˆã§ãã¾ã—ãŸï¼‰ã€‚å››å‰‡æ¼”ç®—ã®ã»ã‹ã«å‰°ä½™ã€ä»£å…¥æ¼”ç®—å­ãŒä½¿ãˆã¾ã™ã€‚ãã®ä»–ã®æ¼”ç®—å­ã¯è¿½åŠ ã™ã‚Œã°ä½¿ãˆã¾ã™ãŒã€ä»Šã¯è¿½åŠ ã—ã¦ã¾ã›ã‚“ï¼ˆæ°—åŠ›ãŒæŒã¡ã¾ã›ã‚“...ç¬‘ï¼‰
â€‹
å”¯ä¸€ã€ã‚«ãƒƒã‚³ãŒãƒã‚¹ãƒˆã•ã‚Œã¦ã‚‹æ•°å¼ã¯ã†ã¾ãè§£æã§ãã¾ã›ã‚“ã€‚å¯¾ç­–æ³•ã‚’æ•™ãˆã¦ãã ã•ã„....ã€‚ã¾ãŸã€OPERATORã®å‡¦ç†ãŒvariableã®éƒ¨åˆ†ã¨åŒã˜ã«ãªã£ã¦ã„ã¾ã™ãŒã€åˆ†å‰²ã—ã¦ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ã€‚ã£ã¦ã‹åˆ†å‰²ã™ã‚‹ã¹ããªã‚“ã§ã™...ã€‚
â€‹
å¤‰æ•°ã®å®šç¾©æ–¹æ³•ã¨ã—ã¦ã¯`expr("a = 2", &test);`ã¨ã™ã‚Œã°ã€ãã‚Œä»¥é™ã®ã‚³ãƒ¼ãƒ‰ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
â€‹
```cpp
expr("a = b + 1", &a); // error. b is undefined.
â€‹
expr("b = 4", &a);
expr("a = b + 1", &a); // a = 5;
```
â€‹
## è¿½è¨˜
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€Œã‚«ãƒƒã‚³ãŒãƒã‚¹ãƒˆã•ã‚ŒãŸæ•°å¼ã€ã€ã‚³ãƒ¡ãƒ³ãƒˆã«ã‚‚ã‚ã‚‹ã‚ˆã†ãªã€Œ"8/4/2", "1-2-3"ã¨ã„ã£ãŸæ•°å¼ã€ãŒã†ã¾ãè§£æã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãªã®ã§ã€BNFè¨˜æ³•ã‹ã‚‰è¦‹ç›´ã—ã¦ã¿ã¾ã—ãŸã€‚
â€‹
### ä¿®æ­£ç‰ˆBNFè¨˜æ³•
å…ƒã€…ã®BNFè¨˜æ³•ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¦ã¿ã¾ã—ãŸã€‚
â€‹
```cpp
/**
 * ãƒãƒƒã‚«ã‚¹è¨˜æ³•(BNF) ï¼ˆ +, -, *, /, '(', ')' ï¼‰
 * å·¦è¾ºã¨åŒã˜éçµ‚ç«¯è¨˜å·ãŒå³è¾ºå…ˆé ­ã«ãã‚‹ã¨ã€Œå·¦å†å¸°æ€§ã€ã«ãªã‚‹
 *
 * ## å¼ã¯é …ã®ã¿ or (+, -)æ¼”ç®—å­ã‚’å«ã‚€å¼ ##
 * expr ::= term, [(+|-) term]*
 *        ;
 *
 * ## é …ã¯å› å­ or (*, /)æ¼”ç®—å­ã‚’å«ã‚€é … ##
 * term ::= factor [(*|/|%) factor]*
 *        ;
 *
 * ## å› å­ã¯æ•°å€¤ or ã‚«ãƒƒã‚³ã‚’å«ã‚€ï¼ˆå¼, é …ï¼‰or æ¼”ç®—å­ã‚’å«ã‚€##
 * factor ::= DIGIT
 *          | VARIABLE
 *          | VARIABLE OPERATOR expr
 *          | '(' expr ')'
 *          ;
 *
 * ## æ•°å€¤ ##
 * DIGIT ::= [0-9]+ ;
 *
 * ## å¤‰æ•°å ##
 * VARIABLE ::= _a-zA-Z [_a-zA-Z0-9]+ ;
 *
 * ## æ¼”ç®—å­ ##
 * OPERATOR ::= '='
 */
```
â€‹
### ä¿®æ­£ç‰ˆæ¼”ç®—å­é–¢æ•°
ãã—ã¦ã€ä¸Šè¨˜ã®BNFè¨˜æ³•ã«æ²¿ã£ã¦"expr", "term", "factor"ã‚’æ›¸ãæ›ãˆã¾ã—ãŸã€‚
â€‹
```cpp:expr
int expr( const char* pc, const char** endp ) {
â€‹
    // 1æ–‡å­—ç›®ï¼ˆå¿…ãštermã«å±ã™ã‚‹ï¼‰ã‚’å–å¾—ã™ã‚‹
    int left = term( pc, endp );
â€‹
    while( true ) {
        if ('+' == **endp)
        {
            // ï¼‹1ã¯ '+' åˆ†ãšã‚‰ã™
            int right = term( *endp + 1, endp );
            left += right;
        }
        else if ('-' == **endp)
        {
            // ï¼‹1ã¯ '-' åˆ†ãšã‚‰ã™
            int right = term( *endp + 1, endp );
            left -= right;
        }
        else if (isspace(**endp))
        {
            *endp += 1;
        } else { break; }
    }
    return left;
}
```
â€‹
```cpp:term
int term( const char* pc, const char** endp ) {
â€‹
    // 1æ–‡å­—ç›®ï¼ˆå¿…ãšfactorã«å±ã™ã‚‹ï¼‰ã‚’å–å¾—ã™ã‚‹
    int left = factor( pc, endp );
â€‹
    while( true ) {
        if ('*' == **endp)
        {
            // ï¼‹1ã¯ '*' åˆ†ãšã‚‰ã™
            int right = factor( *endp + 1, endp );
            left *= right;
        }
        else if ('/' == **endp)
        {
            // ï¼‹1ã¯ '/' åˆ†ãšã‚‰ã™
            int right = factor( *endp + 1, endp );
            left /= right;
        }
        else if ('%' == **endp)
        {
            // ï¼‹1ã¯ '%' åˆ†ãšã‚‰ã™
            int right = factor( *endp + 1, endp );
            left %= right;
        }
        else if (isspace(**endp))
        {
            *endp += 1;
        }
        else { break; }
    }
    return left;
}
```
â€‹
```cpp:factor
int factor( const char* pc, const char** endp ) {
â€‹
    *endp = pc;
â€‹
    while (true) {
        if ('(' == **endp) {
            // ã‚«ãƒƒã‚³åˆ†èª­ã¿é£›ã°ã—
            *endp += 1;
â€‹
            // ã‚«ãƒƒã‚³å†…ã®å¼ã‚’è§£æ
            int innerExprValue = expr(*endp, endp);
â€‹
            // ã‚«ãƒƒã‚³ã¨ã˜ã¾ã§ãƒã‚¤ãƒ³ã‚¿ã‚’é€²ã‚ã‚‹
            while (true) {
                // ã‚«ãƒƒã‚³é–‰ã˜ãªã‚‰
                if (')' == **endp) {
                    // ã‚«ãƒƒã‚³åˆ†é£›ã°ã—
                    (*endp)++;
                    // pcã«æ–‡å­—åˆ—ã‚³ãƒ”ãƒ¼
                    pc = *endp;
â€‹
                    // ã‚«ãƒƒã‚³å†…ã®æ¼”ç®—çµæœã‚’æ–‡å­—åˆ—ã«
                    string valstr = to_string(innerExprValue);
                    char *cstr = new char[valstr.size() + 1]; // ãƒ¡ãƒ¢ãƒªç¢ºä¿
                    strcpy(cstr, valstr.c_str());        // ã‚³ãƒ”ãƒ¼
â€‹
                    // ç¾åœ¨ã®æ–‡å­—åˆ—ã®å…ˆé ­ã«è¨ˆç®—çµæœã‚’é€£çµ
                    char *tmps = strcat(cstr, pc);
â€‹
                    // tmpæ–‡å­—åˆ—ç”¨ã®ãƒ¡ãƒ¢ãƒªé–‹æ”¾
                    delete[] cstr; // ãƒ¡ãƒ¢ãƒªè§£æ”¾
â€‹
                    // é€£çµå¾Œã®æ–‡å­—åˆ—ã‚’pcã«ä»£å…¥
                    pc = tmps;
â€‹
                    // è§£ææ¸ˆã¿æ–‡å­—åˆ—ã«ã‚‚åŒæ§˜ã®ã‚‚ã®ã‚’ä»£å…¥
                    *endp = pc;
â€‹
                    // æ®‹ã‚Šã®æ•°å¼ã®è§£æ
                    int tmp = expr(pc, endp);
â€‹
                    // æ¼”ç®—çµæœã‚’è¿”ã™
                    return tmp;
                } else {
                    *endp += 1;
                }
            }
        } else if (isspace(**endp)) {
            (*endp)++;
        } else if (isdigit(**endp)) {
            return digit(pc, endp);
        } else if (isalpha(**endp)) {
            return variable(pc, endp);
        } else {
            return expr(pc, endp);
        }
    }
}
```
â€‹
### ã‚³ãƒ¼ãƒ‰æ¤œè¨¼
æ›¸ãæ›ãˆãŸã‚‰ã€å‰å›ã®æ¤œè¨¼ã‚³ãƒ¼ãƒ‰ã«åŠ ãˆã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚‚ãƒ†ã‚¹ãƒˆã—ã¾ã—ãŸã€‚
â€‹
```cpp
const char *_one = nullptr;
res = expr("8/4/2", &_one);
print(1, res);
â€‹
const char *_three = nullptr;
res = expr("8/4*2", &_three);
print(4, res);
â€‹
const char *_four = nullptr;
res = expr("2*4/8", &_four);
print(1, res);
â€‹
const char *_two = nullptr;
res = expr("1-2-3", &_two);
print(-4, res);
â€‹
// -----------------------------------------
â€‹
Result: True
-- ExpectedValue: 1, CalculatedValue: 1
Result: True
-- ExpectedValue: 4, CalculatedValue: 4
Result: True
-- ExpectedValue: 1, CalculatedValue: 1
Result: True
-- ExpectedValue: -4, CalculatedValue: -4
```
â€‹
ã“ã‚Œã§ã€ä¸€å¿œã¯è¨ˆç®—ã‚’çœŸé¢ç›®ã«ã™ã‚‹ã“ã¨ã¯ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹...ã€‚ï¼ˆãŸã¶ã‚“ï¼‰
â€‹
### ä¸æ˜ç‚¹
ã€Œã‚«ãƒƒã‚³ãŒãƒã‚¹ãƒˆã•ã‚ŒãŸæ•°å¼ã€ã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡¦ç†ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚
â€‹
```cpp
// ã‚«ãƒƒã‚³å†…ã®æ¼”ç®—çµæœã‚’æ–‡å­—åˆ—ã«
string valstr = to_string(innerExprValue);
char *cstr = new char[valstr.size() + 1]; // ãƒ¡ãƒ¢ãƒªç¢ºä¿
strcpy(cstr, valstr.c_str());        // ã‚³ãƒ”ãƒ¼
â€‹
// ç¾åœ¨ã®æ–‡å­—åˆ—ã®å…ˆé ­ã«è¨ˆç®—çµæœã‚’é€£çµ
char *tmps = strcat(cstr, pc);
â€‹
// tmpæ–‡å­—åˆ—ç”¨ã®ãƒ¡ãƒ¢ãƒªé–‹æ”¾
delete[] cstr; // ãƒ¡ãƒ¢ãƒªè§£æ”¾
```
â€‹
ãŸã ã€ãƒ‡ãƒãƒƒã‚°ã®ã‚ˆã†ã«ãƒ©ã‚¤ãƒ³å®Ÿè¡Œã ã¨ã€ã†ã¾ãã„ãã®ã§ã™ãŒã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å®Ÿè¡Œã ã¨æ–‡å­—åˆ—é€£çµãŒã†ã¾ãè¡Œã‚ã‚Œã¾ã›ã‚“ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®çµ„ã¿æ–¹ãŒæ‚ªã„ã‚“ã ã¨æ€ã„ã¾ã™ãŒã€è¦æ¤œè¨ç‚¹ã§ã™...ã€‚
â€‹
ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚Šã¾ã›ã‚“